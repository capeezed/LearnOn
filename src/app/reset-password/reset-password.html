<div class="login-container d-flex align-items-center justify-content-center min-vh-100">
    <div class="card shadow-lg login-card-compact border-0"> 
        <div class="card-body p-4">

            <div class="text-center mb-3"> 
                <h3 class="fw-bold text-custom-primary mb-1">Redefinir Senha</h3>
                <p class="text-muted small">Insira e confirme sua nova senha.</p>
            </div>
            
            <hr class="my-3">

            <div *ngIf="errorMessage && !resetForm" class="alert alert-danger py-2 small">{{ errorMessage }}</div>

            <form *ngIf="token" [formGroup]="resetForm" (ngSubmit)="onSubmit()">

                <div *ngIf="successMessage" class="alert alert-success py-2 small">{{ successMessage }}</div>
                <div *ngIf="errorMessage && resetForm" class="alert alert-danger py-2 small">{{ errorMessage }}</div>

                <div class="mb-3">
                    <label for="novaSenha" class="form-label fw-bold small">Nova Senha</label>
                    <input type="password" class="form-control form-control-sm" id="novaSenha" formControlName="novaSenha"
                        [class.is-invalid]="novaSenha?.invalid && (novaSenha?.dirty || novaSenha?.touched)">
                    <div *ngIf="novaSenha?.invalid && (novaSenha?.dirty || novaSenha?.touched)" class="invalid-feedback small">
                        <div *ngIf="novaSenha?.errors?.['required']">A nova senha é obrigatória.</div>
                        <div *ngIf="novaSenha?.errors?.['minlength']">Mínimo de 6 caracteres.</div>
                    </div>
                </div>

                <div class="mb-4">
                    <label for="confirmacaoNovaSenha" class="form-label fw-bold small">Confirmar Nova Senha</label>
                    <input type="password" class="form-control form-control-sm" id="confirmacaoNovaSenha" formControlName="confirmacaoNovaSenha"
                        [class.is-invalid]="confirmacaoNovaSenha?.invalid && (confirmacaoNovaSenha?.dirty || confirmacaoNovaSenha?.touched)">
                    
                    <div *ngIf="confirmacaoNovaSenha?.errors?.['mismatch']" class="invalid-feedback d-block small">
                         As senhas não coincidem.
                    </div>
                </div>

                <button 
                    type="submit" 
                    class="btn btn-custom w-100 fw-bold py-2 mt-2" 
                    [disabled]="resetForm.invalid || isSubmitting"
                >
                    {{ isSubmitting ? 'Redefinindo...' : 'Redefinir Senha' }}
                </button>
            </form>

            <div class="mt-3 text-center">
                <a routerLink="/login" class="text-muted smaller-link text-decoration-none">Lembrou da senha? Voltar para Login.</a>
            </div>

        </div>
    </div>
</div>