<div class="login-container d-flex align-items-center justify-content-center bg-light py-5">
  <div class="card shadow-lg login-card">
    <div class="card-body p-5">

      <div class="text-center mb-4">
        <h2 class="fw-bold text-custom-primary">Redefinir Senha</h2>
        <p class="text-muted">Escolha sua nova senha segura.</p>
      </div>

      <div *ngIf="errorMessage" class="alert alert-danger mb-4">{{ errorMessage }}</div>
      <div *ngIf="successMessage" class="alert alert-success mb-4">{{ successMessage }}</div>
      
      <div *ngIf="!tokenValid && !errorMessage && !successMessage" class="alert alert-warning mb-4">
        O link de redefinição é inválido ou expirou. Solicite um novo.
      </div>

      <form [formGroup]="resetForm" (ngSubmit)="onSubmit()" *ngIf="tokenValid">

        <div class="mb-3">
          <label for="novaSenha" class="form-label fw-bold">Nova Senha</label>
          <input type="password" class="form-control" id="novaSenha" formControlName="novaSenha"
            [class.is-invalid]="novaSenha?.invalid && (novaSenha?.dirty || novaSenha?.touched)">
          <div *ngIf="novaSenha?.invalid && (novaSenha?.dirty || novaSenha?.touched)" class="invalid-feedback">
            <div *ngIf="novaSenha?.errors?.['required']">A senha é obrigatória.</div>
            <div *ngIf="novaSenha?.errors?.['minlength']">A senha deve ter no mínimo 6 caracteres.</div>
          </div>
        </div>

        <div class="mb-4">
          <label for="confirmacaoNovaSenha" class="form-label fw-bold">Confirmar Nova Senha</label>
          <input type="password" class="form-control" id="confirmacaoNovaSenha" formControlName="confirmacaoNovaSenha"
            [class.is-invalid]="confirmacaoNovaSenha?.invalid && (confirmacaoNovaSenha?.dirty || confirmacaoNovaSenha?.touched) || (resetForm.errors?.['senhasDiferentes'] && confirmacaoNovaSenha?.touched)">
          
          <div *ngIf="confirmacaoNovaSenha?.invalid && (confirmacaoNovaSenha?.dirty || confirmacaoNovaSenha?.touched)" class="invalid-feedback">
             <div *ngIf="confirmacaoNovaSenha?.errors?.['required']">Confirmação é obrigatória.</div>
          </div>
          <div *ngIf="resetForm.errors?.['senhasDiferentes'] && confirmacaoNovaSenha?.touched" class="invalid-feedback d-block">
            As senhas não coincidem.
          </div>
        </div>

        <button 
          type="submit" 
          class="btn btn-custom w-100 fw-bold py-2" 
          [disabled]="resetForm.invalid || isLoading"
        >
          <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
          {{ isLoading ? 'Redefinindo...' : 'Redefinir Senha' }}
        </button> 
      </form>

      <div class="mt-4 text-center">
        <a routerLink="/login" class="text-muted small">Voltar para Login</a>
      </div>

    </div>
  </div>
</div>